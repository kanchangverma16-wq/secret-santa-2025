<!DOCTYPE html>
<!-- Firebase-enabled Secret Santa Spinner -->
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Secret Santa 2025</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>

<script>
// ******ğŸ”¥ ADD YOUR FIREBASE CONFIG HERE ğŸ”¥******
 const firebaseConfig = {
        apiKey: "AIzaSyCprZAsGsGtcDvxm376dFYuIXM5fvgZ8fY",
        authDomain: "secret-santa2025.firebaseapp.com",
        projectId: "secret-santa2025",
        storageBucket: "secret-santa2025.firebasestorage.app",
        messagingSenderId: "388087975466",
        appId: "1:388087975466:web:3090c2ec5cd17bcccfbd53"
    };    
// ***********************************************

const app = firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
</script>

<style>
body { font-family:'Inter',sans-serif; background:#064e3b; color:white; padding:20px;}
#wheelCanvas { border-radius:50%; border:8px solid #facc15;}
</style>
</head>

<body>
<h1 class="text-3xl font-black text-center text-red-400">Secret Santa 2025</h1>

<input id="emailInput" class="p-3 text-black w-full max-w-sm mt-4 rounded" placeholder="Enter email" />

<button onclick="spinWheel()" class="bg-red-600 mt-4 p-3 rounded text-white font-bold">
Spin ğŸ„
</button>

<div id="resultMessage" class="mt-4 font-bold"></div>

<canvas id="wheelCanvas" width="300" height="300" class="mt-6"></canvas>

<script>
const ALL_PARTICIPANTS = [
 {name:"Adhoni, Arif", email:"arif.adhoni@ecolab.com"},
 {name:"Adhyapak, Sanket", email:"sanket.adhyapak@ecolab.com"},
 {name:"Agrawal, Sakshi", email:"sakshi.agrawal@ecolab.com"},
 {name:"Ahamed, Bilal", email:"bilal.ahamed@ecolab.com"},
 {name:"Vinu, Karthik", email:"karthik.vinu@ecolab.com"},
{ name: "Verma, Kanchan", email: "kanchan.verma@ecolab.com" },
    { name: "Nair, Anuja", email: "anuja.nair@ecolab.com" },
    { name: "Singh, Pragya", email: "pragya.singh@ecolab.com" }

];

const canvas = document.getElementById("wheelCanvas");
const ctx = canvas.getContext("2d");

const WHEEL_ITEMS = ["ğŸ","ğŸ„","â„ï¸","ğŸª","ğŸ¦Œ","ğŸŒŸ","ğŸ¬","â˜ƒï¸","ğŸ…","ğŸ›·"];
const arc = (2 * Math.PI) / WHEEL_ITEMS.length;
let spinAngleStart = 0;
let isSpinning = false;

function drawWheel(){
 ctx.clearRect(0,0,300,300);
 for(let i=0;i<WHEEL_ITEMS.length;i++){
   let angle = i*arc;
   ctx.beginPath();
   ctx.fillStyle = i%2===0 ? "#dc2626" : "#15803d";
   ctx.moveTo(150,150);
   ctx.arc(150,150,150,angle,angle+arc);
   ctx.fill();
   ctx.save();
   ctx.translate(150,150);
   ctx.rotate(angle + arc/2);
   ctx.fillStyle="white";
   ctx.font="24px serif";
   ctx.fillText(WHEEL_ITEMS[i],90,10);
   ctx.restore();
 }
}
drawWheel();

async function spinWheel(){
 if(isSpinning) return;

 const email = document.getElementById("emailInput").value.trim().toLowerCase();
 const person = ALL_PARTICIPANTS.find(p=>p.email===email);
 const msg = document.getElementById("resultMessage");

 if(!person){
   msg.innerHTML = "âŒ Email not registered.";
   return;
 }

 // Check Firestore for existing result
 const docRef = db.collection("secretSanta").doc(email);
 const docSnap = await docRef.get();

 if(docSnap.exists){
   msg.innerHTML = "ğŸ„ You already drew: " + docSnap.data().target;
   return;
 }

 isSpinning = true;
 msg.innerHTML = "Spinningâ€¦ ğŸ…";

 // Spin animation
 let totalRotation = (Math.random()*5 + 5) * 360;
 let finalIndex = Math.floor(Math.random()*WHEEL_ITEMS.length);
 totalRotation += finalIndex * (360 / WHEEL_ITEMS.length);

 canvas.style.transition = "transform 4s cubic-bezier(.25,.1,.25,1)";
 canvas.style.transform = `rotate(${totalRotation}deg)`;

 setTimeout(async ()=>{
   isSpinning = false;

   // Assign Secret Santa
   const allResults = await db.collection("assignments").get();
   const assignedNames = allResults.docs.map(d=>d.data().target);

   let available = ALL_PARTICIPANTS
       .map(p=>p.name)
       .filter(n => n !== person.name && !assignedNames.includes(n));

   if(available.length === 0){
     msg.innerHTML = "âš ï¸ No valid assignments left. Contact admin.";
     return;
   }

   const assignedName = available[Math.floor(Math.random()*available.length)];

   await docRef.set({
     email: email,
     target: assignedName,
     timestamp: new Date().toISOString()
   });

   msg.innerHTML = "ğŸ‰ Your Secret Santa target is: <b>" + assignedName + "</b>";
 },4100);
}
</script>

</body>
</html>
